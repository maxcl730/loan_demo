{% extends "manage/base.html" %}
{% from "manage/_macros.html" import render_pagination %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block title %}{{ _fsdomain('Members') }}{% endblock %}
{% block css %}
    <link rel="stylesheet" href="{{ makeup_static_url('plugins/datepicker/bootstrap-datepicker.min.css') }}">
{% endblock %}

{% block navbar %}
    <h1>{{ _fsdomain('Members') }}</h1>
{% endblock %}

{% include 'manage/message.html' %}

{% block content %}
<div class="box box-primary">
    <div class="box-header with-border">
        <form action="{{ url_for('manage_member.list_member') }}" method="post" class="form horizontal" role="form" name="search_form">
            {{ form.hidden_tag() }}
            {{ wtf.form_errors(form, hiddens="only") }}
            <div class="form-group">
                <label class="label-sm">{{ form.national_id.label.text }}</label> {{ form.national_id }} &nbsp;&nbsp;</br>
                <label class="label-sm">{{ form.mobile.label.text }}</label> {{ form.mobile }} &nbsp;&nbsp;
                <label class="label-sm">{{ form.created_time_begin.label.text }}</label> {{ form.created_time_begin }} &nbsp;&nbsp;
                <label class="label-sm">{{ form.created_time_end.label.text }}</label> {{ form.created_time_end }} &nbsp;&nbsp;
                <input type="submit" value="{{ _fsdomain('Search') }}" class="btn-xs"/></br>
                <label class="label-sm">{{ _fsdomain('Credit Info')  }}</label>
                <input name="" type="button" value="show" id="creditshowbtn">
            </div>
        </form>
    </div>
    <div class="box-body">
        <table class="table table-bordered">
            <tr>
                <th>{{ _fsdomain('National/Resident ID') }}</th>
                <th>{{ _fsdomain('Mobile') }}</th>
                <th>{{ _fsdomain('birthday') }}</th>
                <th>{{ _fsdomain('gender') }}</th>
                <th>{{ _fsdomain('Applications') }}</th>
                <th>{{ _fsdomain('Creation Date') }}</th>
            </tr>
            {% for item in list.items %}
            <tr>
                <td>{{ item.national_id }}</td>
                <td>{{ item.mobile }}</td>
                <td>{{ item.birthday}}</td>
                <td>{{ item.sex_text}}</td>
                <td>{{ count_list[item.id.__str__()][0] }}</td>
                <td>{{ item.created_time.strftime('%Y-%m-%d %H:%M:%S')}}</td>
            </tr>
            <tr class="creditinfo" style="display: none;">
                <td bgcolor="#F0F9FB" colspan="6"><p>
                    <b>Member credit info:</b>&nbsp;&nbsp;
                    {{ item.credit_info | show_unicode}} <br>
                    <b>Address (Arabic):</b>&nbsp;&nbsp;
                    {{ item.credit_address_a | show_unicode}} <br>
                    <b>Address (English):</b>&nbsp;&nbsp;
                    {{ item.credit_address_e | show_unicode}}
                </p>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {{ render_pagination(list, 'manage_member.list_member') }}
</div>
{% endblock %}
{% block scripts %}
    <script src="{{ makeup_static_url('plugins/datepicker/bootstrap-datepicker.min.js') }}"></script>
    <script>
    $(function() {

        $('#created_time_begin').datepicker({
            format: 'yyyy-mm-dd',
            language: 'zh-cn',
            //startDate: new Date()
        })
        $('#created_time_end').datepicker({
            format: 'yyyy-mm-dd',
            language: 'zh-cn',
            //startDate: new Date()
        })
        $("a.page").on('click',function(){
            let newUrl = $(this).attr("id");
            //alert(newUrl);
            $("form[name='search_form']").attr('action',newUrl);
            $("form[name='search_form']").submit();
        })
    });
    $(function(){
        $("#creditshowbtn").click(function(){
            if ($(this).val()=="show"){
                $(this).val("hide")
                var trs = $("tr[class='creditinfo']");
                for(i = 0; i < trs.length; i++){
                    trs[i].style.display = ""; //这里获取的trs[i]是DOM对象而不是jQuery对象，因此不能直接使用hide()方法
                }
            }else{
                $(this).val("show")
                var trs = $("tr[class='creditinfo']");
                for(i = 0; i < trs.length; i++){
                    trs[i].style.display = "none"; //这里获取的trs[i]是DOM对象而不是jQuery对象，因此不能直接使用hide()方法
                }
            }
        })
    })
    </script>
{% endblock %}
